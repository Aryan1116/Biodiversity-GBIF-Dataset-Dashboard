# -*- coding: utf-8 -*-
"""Final_app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1w60scBKAjg0d37YplPAmhrWBiPz0F9fr
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

df1 = pd.read_csv('/content/dataset_1.csv')

df1.head()

summary = {
    "shape": df1.shape,
    "dtypes": df1.dtypes.value_counts(),
    "missing_values": df1.isna().sum().sort_values(ascending=False),
    "unique_counts": df1.nunique().sort_values(ascending=False)
}

summary

# basically we have 11 columns whicch have 100% missing values so it is safe to remvoe the 11 columnsas they have no useful information
unuseful_col = {'elevation',
'locality',
'recordNumber',
'depthAccuracy',
'depth',
'elevationAccuracy',
'coordinatePrecision',
'establishmentMeans',
'typeStatus',
'verbatimScientificNameAuthorship',
'individualCount',
'infraspecificEpithet'}

df1.drop(columns=unuseful_col,inplace=True)

df1.shape

df1['class'].nunique()

df1['class'].unique()

df1.dropna(subset=['class'],inplace=True)

df1['class'].isnull().value_counts()

# only 1.34% of class values are missing so it is safe to drop the rows having missing values

df1['class'].value_counts()

df1.dropna(subset=['decimalLatitude', 'decimalLongitude'],inplace=True)

tax_cols = ['phylum','family','genus','order','species','speciesKey']
df1[tax_cols] = df1[tax_cols].fillna("Unknown")

import matplotlib.pyplot as plt
plt.figure(figsize=(12,6))
df1['class'].value_counts().head(15).plot(kind='bar')
plt.title("Top 15 Most Common Classes")
plt.xlabel("Class")
plt.ylabel("Frequency")
plt.show()

df1['kingdom'].value_counts()

import matplotlib.pyplot as plt
plt.figure(figsize=(12,6))
df1['kingdom'].value_counts().plot(kind='bar')
plt.title("Top  Most Common Kingdoms")
plt.xlabel("Class")
plt.ylabel("Frequency")
plt.show()

# Get top 10 classes by frequency
import seaborn as sns
top_classes = df1['class'].value_counts().head(10).index

df_top = df1[df1['class'].isin(top_classes)]

plt.figure(figsize=(14,6))
sns.boxplot(data=df_top, x='class', y='decimalLatitude')
plt.xticks(rotation=45)
plt.title("Latitude Distribution for Top 10 Classes")
plt.show()

# Violin plot
plt.figure(figsize=(14,6))
sns.violinplot(data=df_top, x='class', y='decimalLatitude')
plt.xticks(rotation=45)
plt.title("Latitude Distribution for Top 10 Classes (Violin)")
plt.show()

# class vs longitutde
plt.figure(figsize=(14,6))
sns.boxplot(data=df_top, x='class', y='decimalLongitude')
plt.xticks(rotation=45)
plt.title("Longitude Distribution for Top 10 Classes")
plt.show()

# class vs Month (Seasonilty Pattern)
plt.figure(figsize=(14,6))
sns.countplot(data=df_top, x='month', hue='class')
plt.title("Seasonality: Observations per Month Across Top 10 Classes")
plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left')
plt.show()

# class vs year (trend over time)
plt.figure(figsize=(14,6))
sns.countplot(data=df_top, x='year', hue='class')
plt.xticks(rotation=90)
plt.title("Year-wise Observation Trends for Top 10 Classes")
plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left')
plt.show()

# visualization only after 2000
df_recent = df_top[df_top['year'] >= 2000]

plt.figure(figsize=(14,6))
sns.countplot(data=df_recent, x='year', hue='class')
plt.xticks(rotation=90)
plt.title("Year-wise Observation Trends (2000 onwards)")
plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left')
plt.show()

# line plot for the above same
year_class_counts = df_top.groupby('year').size()

plt.figure(figsize=(14,6))
sns.lineplot(x=year_class_counts.index, y=year_class_counts.values)
plt.title("Observation Trend Over Years")
plt.xlabel("Year")
plt.ylabel("Number of Observations")
plt.show()

df1.drop(columns=['mediaType'],inplace=True)

df1.shape

#Class vs coordinateUncertaintyInMeters (Data Quality / Precision)
plt.figure(figsize=(14,6))
sns.boxplot(data=df_top, x='class', y='coordinateUncertaintyInMeters')
plt.yscale("log")  # log scale to handle extreme values
plt.xticks(rotation=45)
plt.title("Coordinate Uncertainty Distribution Across Top 10 Classes")
plt.show()

df1.columns.tolist()

# country - level observation distribution
plt.figure(figsize=(12,6))
df1['countryCode'].value_counts().head(15).plot(kind='bar')
plt.title("Top 15 Countries by Observation Count")
plt.xlabel("Country Code")
plt.ylabel("Count")
plt.show()

# Class(top 10) distribution across Countries(top 10)
# Top 10 classes overall
top_classes = df1['class'].value_counts().head(10).index

# Filter for only top 10 classes
df_top_class = df1[df1['class'].isin(top_classes)]

# Top 10 countries within the filtered classes subset
top_countries = df_top_class['countryCode'].value_counts().head(10).index

# Filter dataset for top 10 countries
df_country = df_top_class[df_top_class['countryCode'].isin(top_countries)]

plt.figure(figsize=(14,6))
sns.countplot(data=df_country, x='countryCode', hue='class')
plt.title("Class Distribution Across Top 10 Countries (Top 10 Classes Only)")
plt.xticks(rotation=45)
plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left')
plt.show()

# Filter data for India only
df_india = df1[df1['countryCode'] == 'IN']

# Class distribution
plt.figure(figsize=(12,6))
df_india['class'].value_counts().head(10).plot(kind='bar')
plt.title("Top 10 Classes Observed in India")
plt.xlabel("Class")
plt.ylabel("Count")
plt.xticks(rotation=45)
plt.show()

# Species level distribution(top 10)
plt.figure(figsize=(12,6))
df_india['species'].value_counts().head(10).plot(kind='bar')
plt.title("Top 10 Species Observed in India")
plt.xlabel("Species")
plt.ylabel("Count")
plt.xticks(rotation=45)
plt.show()

# genus level distribution
plt.figure(figsize=(12,6))
df_india['genus'].value_counts().head(10).plot(kind='bar')
plt.title("Top 10 Genera Observed in India")
plt.xlabel("Genus")
plt.ylabel("Count")
plt.xticks(rotation=45)
plt.show()

# Seasonality in India
plt.figure(figsize=(14,6))
sns.countplot(data=df_india, x='month', hue='class')
plt.title("Seasonality of Observations Across Classes in India")
plt.xticks(rotation=45)
plt.legend(bbox_to_anchor=(1.05,1), loc='upper left')
plt.show()

# Geographic Spread in India (Lat-Long Scatter)
plt.figure(figsize=(10,8))
sns.scatterplot(data=df_india, x='decimalLongitude', y='decimalLatitude', hue='class', s=10)
plt.title("Geographic Distribution of Observations in India (By Class)")
plt.xlabel("Longitude")
plt.ylabel("Latitude")
plt.legend(bbox_to_anchor=(1.05,1), loc='upper left')
plt.show()

# Compare India vs US (Class Differences)
df_us = df1[df1['countryCode'] == 'US']

# Keep only top 10 classes for readability
top_classes = df1['class'].value_counts().head(10).index
df_compare = pd.concat([
    df_india[df_india['class'].isin(top_classes)],
    df_us[df_us['class'].isin(top_classes)]
])

plt.figure(figsize=(14,6))
sns.countplot(data=df_compare, x='countryCode', hue='class')
plt.title("Class Distribution Comparison: India vs USA")
plt.xlabel("Country")
plt.ylabel("Count")
plt.legend(bbox_to_anchor=(1.05,1), loc='upper left')
plt.show()

# Geographic Heatmap / Density Map
plt.figure(figsize=(8,10))
sns.kdeplot(data=df_india, x='decimalLongitude', y='decimalLatitude', fill=True, cmap='viridis', thresh=0.05)
plt.title("Biodiversity Density Heatmap in India")
plt.show()

# Sunburst Plot
import plotly.express as px
fig = px.sunburst(df1, path=['kingdom','phylum','class','order'], values='gbifID')
fig.show()

# India only sunburst
import plotly.express as px
# Filter dataset for India only
df_india = df1[df1['countryCode'] == 'IN']

# Build sunburst chart
fig = px.sunburst(
    df_india,
    path=['kingdom','phylum','class','order'],   # hierarchy levels
    values=None,                                  # count rows automatically
    title="Taxonomic Diversity Sunburst Chart - India",
    width=900,
    height=900
)

fig.show()

# shannon Index
import numpy as np

# species counts for India
species_counts = df_india['species'].value_counts()
proportions = species_counts / species_counts.sum()

shannon_index = -np.sum(proportions * np.log(proportions))
shannon_index

# Simpsons Diversity Index
simpson_index = 1 - np.sum(proportions**2)
simpson_index

# Shannon & Simpson Richness per Month (India)
import numpy as np

# Filter India
df_india = df1[df1['countryCode'] == 'IN']

monthly_richness = {}

for m in range(1,13):
    species_month = df_india[df_india['month'] == m]['species'].value_counts()
    proportions = species_month / species_month.sum()

    if len(proportions) > 0:
        shannon = -np.sum(proportions * np.log(proportions))
        simpson = 1 - np.sum(proportions**2)
    else:
        shannon = 0
        simpson = 0

    monthly_richness[m] = [shannon, simpson]

richness_df = pd.DataFrame(monthly_richness, index=['Shannon', 'Simpson']).T
print(richness_df)

# Plot richness by month
plt.figure(figsize=(10,5))
plt.plot(richness_df.index, richness_df['Shannon'], marker='o')
plt.title("Monthly Biodiversity Richness in India (Shannon Index)")
plt.xlabel("Month")
plt.ylabel("Richness")
plt.show()

state_richness = {}

for state in df_india['stateProvince'].unique():
    species_state = df_india[df_india['stateProvince'] == state]['species'].value_counts()
    proportions = species_state / species_state.sum()

    if len(proportions) > 0:
        shannon_state = -np.sum(proportions * np.log(proportions))
        simpson_state = 1 - np.sum(proportions**2)
    else:
        shannon_state = 0
        simpson_state = 0

    state_richness[state] = [shannon_state, simpson_state]

state_richness_df = pd.DataFrame(state_richness, index=['Shannon','Simpson']).T
state_richness_df = state_richness_df.sort_values(by='Shannon', ascending=False)

print(state_richness_df.head(10))

# Plot top 10 biodiversity states (Shannon)
plt.figure(figsize=(12,6))
state_richness_df.head(10)['Shannon'].plot(kind='bar')
plt.title("Top 10 Indian States by Biodiversity Richness (Shannon)")
plt.xlabel("State")
plt.ylabel("Richness")
plt.xticks(rotation=45)
plt.show()

